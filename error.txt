# Capture the current user's context (username)
$UserContext = ([System.Security.Principal.WindowsIdentity]::GetCurrent()).Name

# Set the path to the MSIX bundle in the Temp folder
$msixBundlePath = "C:\Temp\Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbundle"

# Set the Task Scheduler job name
$taskName = "InstallMSIXDesktopAppInstaller"

# Create the Task Action to run the PowerShell command to install the MSIX bundle
$action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-Command Add-AppxPackage -Path '$msixBundlePath'"

# Set the Task Trigger for a one-time task (this example runs in 1 minute from now)
$trigger = New-ScheduledTaskTrigger -At (Get-Date).AddMinutes(1)

# Create a Task Scheduler registration to execute the task as the current user
Register-ScheduledTask -Action $action -Trigger $trigger -TaskName $taskName -RunLevel Highest -User $UserContext

# Optionally, to clean up the task after it's completed, you can include:
# Unregister-ScheduledTask -TaskName $taskName -Confirm:$false
